Add-PSSnapin VMware.VimAutomation.Core
. 'C:/Program Files (x86)/VMware/Infrastructure/vSphere PowerCLI/Scripts/Initialize-PowerCLIEnvironment.ps1'

###### Initilization done ######

# ENTER vCenter IP address or FQDN:
$vCenterAddress = "x.x.x.x"

# ENTER vCenter Username here:
$vCenterUser = "example_vcenter_username"

# ENTER vCenter Password here:
$vPassword = "example_vcenter_password"

$cluster = "example_cluster_name"

# ENTER VM prefix name:
#$VMprefix = "example_vm_prefix"


###### End of user input ######

#Connecting to vCenter...
Connect-VIServer $vCenterAddress -User $vCenterUser -Password $vPassword -WarningAction SilentlyContinue

#$VMsearch = $VMprefix + "*"
#$vms = Get-VM -Name $VMsearch

$vms = Get-VM -Location $cluster

foreach($vm in $vms) {

    Shutdown-VMGuest -VM $vm

}
